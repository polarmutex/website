---
import { CollectionEntry, getCollection } from 'astro:content';
import { TWITTER_HANDLE } from '@config';
import Layout from '@layouts/Layout.astro';

export interface Props {
    post: CollectionEntry<'posts'>;
}

export async function getStaticPaths() {
    const posts = await getCollection('posts', ({ data }) => !data.draft);

    const postResult = posts.map((post) => ({
        params: { slug: post.slug },
        props: { post },
    }));

    return [...postResult];
}

const { slug } = Astro.params;
const { post } = Astro.props;

const { title, author, description, ogImage, pubDatetime, tags } = post.data;
const { Content } = await post.render();
---

<Layout>
    <article
        class="items-start justify-center w-full mx-auto mt-16 mb-32 prose swyxcontent dark:prose-invert max-w-none"
    >
        <h1
            class="md:text-center mb-8 text-3xl font-bold tracking-tight text-black dark:text-white md:text-5xl"
        >
            {title}
        </h1>
        <div
            class="flex justify-between w-full mt-2 bg border-red sm:items-start md:flex-row md:items-center"
        >
            <p class="flex items-center text-sm text-gray-700 dark:text-gray-300">swyx</p>
            <p class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                {new Date(pubDatetime).toISOString().slice(0, 10)}
            </p>
        </div>
        <!--line break <div
            class="-mx-4 my-2 flex h-1 w-[100vw] bg-gradient-to-r from-yellow-400 via-red-500 to-pink-500 sm:mx-0 sm:w-full"
        >-->
        <Content />
    </article>
</Layout>

<style>
    /* https://ryanmulligan.dev/blog/layout-breakouts/ */
    .swyxcontent {
        --gap: clamp(1rem, 6vw, 3rem);
        --full: minmax(var(--gap), 1fr);
        /* --content: min(65ch, 100% - var(--gap) * 2); */
        --content: 65ch;
        --popout: minmax(0, 2rem);
        --feature: minmax(0, 5rem);
        display: grid;
        grid-template-columns:
            [full-start] var(--full)
            [feature-start] 0rem
            [popout-start] 0rem
            [content-start] var(--content) [content-end]
            [popout-end] 0rem
            [feature-end] 0rem
            var(--full) [full-end];
    }
    @media (min-width: 768px) {
        .swyxcontent {
            grid-template-columns:
                [full-start] var(--full)
                [feature-start] var(--feature)
                [popout-start] var(--popout)
                [content-start] var(--content) [content-end]
                var(--popout) [popout-end]
                var(--feature) [feature-end]
                var(--full) [full-end];
        }
    }
    :global(.swyxcontent > *) {
        grid-column: content;
    }
    article :global(pre) {
        grid-column: feature;
        margin-left: -1rem;
        margin-right: -1rem;
    }
    /* hacky thing because otherwise the summary>pre causes overflow */
    article :global(summary > pre) {
        max-width: 90vw;
    }
    article :global(.popout) {
        grid-column: popout;
    }
    article :global(.feature) {
        grid-column: feature;
    }
    article :global(.full) {
        grid-column: full;
        width: 100%;
    }
    article :global(.admonition) {
        @apply p-8 border-4 border-red-500;
    }
    /* fix github codefence diff styling from our chosen prismjs theme */
    article :global(.token.inserted) {
        background: #00ff0044;
    }
    article :global(.token.deleted) {
        background: #ff000d44;
    }
</style>
